<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{font-family:'Segoe UI',sans-serif;background:#0d1117;color:#e6edf3;margin:0;padding:0}
header{background:#161b22;padding:1rem;text-align:center;color:#58a6ff}
main{padding:2rem;max-width:1000px;margin:0 auto}
h2{color:#58a6ff;margin-bottom:1rem}
table{width:100%;border-collapse:collapse;margin-bottom:2rem}
th,td{padding:.75rem;text-align:left;border-bottom:1px solid #30363d}
th{background:#161b22}
tr.unread{font-weight:bold;background:#161b22}
button{padding:.4rem .8rem;border:none;border-radius:5px;background:#58a6ff;color:#0d1117;cursor:pointer;transition:background .2s}
button:hover{background:#1f6feb}
</style>
</head>
<body>

<header>
<h1>Admin Dashboard</h1>
<p>Welcome, Admin</p>
</header>

<main>
<h2>Messages Inbox</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Message</th>
<th>Date</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="messages-table">
<!-- Messages will load here -->
</tbody>
</table>
</main>

<script>
const SUPABASE_URL = "https://isoxqxakxhqcjoqqbswn.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_2Jv93KvSyoKsFfTRKa1VOw__JMkimwW";
const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Load messages
async function fetchMessages(){
  const { data, error } = await supabase
    .from('messages')
    .select('*')
    .order('date', {ascending:false});

  if(error){console.error(error); return;}
  const tbody = document.getElementById("messages-table");
  tbody.innerHTML = '';

  data.forEach(msg=>{
    const tr = document.createElement('tr');
    tr.className = msg.read ? '' : 'unread';
    tr.innerHTML = `
      <td>${msg.name}</td>
      <td>${msg.email}</td>
      <td>${msg.message}</td>
      <td>${new Date(msg.date).toLocaleString()}</td>
      <td>${msg.read ? 'Read' : 'Unread'}</td>
      <td>
        <button onclick="markRead(${msg.id})">Mark Read</button>
        <button onclick="deleteMessage(${msg.id})" style="background:#d9534f">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Mark message as read
async function markRead(id){
  const { error } = await supabase
    .from('messages')
    .update({read:true})
    .eq('id', id);
  if(error){console.error(error); return;}
  fetchMessages();
}

// Delete message
async function deleteMessage(id){
  if(!confirm("Are you sure you want to delete this message?")) return;
  const { error } = await supabase
    .from('messages')
    .delete()
    .eq('id', id);
  if(error){console.error(error); return;}
  fetchMessages();
}

// Load messages on page load
fetchMessages();
</script>

</body>
</html>
